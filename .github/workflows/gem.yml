on:
    push:
      branches:
        - master
  
jobs:
    deploy:
      runs-on: ubuntu-latest
  
      steps:
        - name: Checkout Repository
          uses: actions/checkout@v2
  
        - name: Set up Docker Buildx
          uses: docker/setup-buildx-action@v1
  
        - name: Prepare service account key
          run: |
            echo -n "${{ secrets.GCP_SA_KEY }}" | base64 -d > /tmp/gcp-key.json
            gcloud auth activate-service-account --key-file=/tmp/gcp-key.json
        
        
  
        - name: Set project ID
          run: |
            gcloud config set project "***"
  
        - name: Build and Deploy with Skaffold
          run: |
            skaffold run
  